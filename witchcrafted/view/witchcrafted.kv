#: kivy 2.1
#: import CardView witchcrafted.cards.card_view
#: import CardPanel witchcrafted.cards.card_panel
#: import CardEdit witchcrafted.cards.card_edit
#: import MainPanel witchcrafted.main_panel

MainPanel:
    id: main_panel
    size_hint: 1., 1.
    pos_hint: {'center_x': .5, 'center_y': .5}
    do_default_tab: False

    selected_card_id: None
    card_view_tab: card_view_tab
    card_edit_tab: card_edit_tab
    card_view: card_view
    card_edit: card_edit

    TabbedPanelItem:
        id: card_view_tab
        text: 'Card Pool'
        CardView:
            id: card_view
            on_scroll_y: self.scroll_data()
            viewclass: 'CardPanel'

            card_grid: card_grid
            num_of_cards: 0
            num_of_columns: 4
            num_of_rows: 4

            RecycleGridLayout:
                id: card_grid
                cols: card_view.num_of_columns
                size_hint_y: None
                height: self.minimum_height
                default_size_hint: 1, None
                default_size: 1, 400

    TabbedPanelItem:
        id: card_edit_tab
        text: 'Edit Card'
        CardEdit:
            id: card_edit

            cols: 1
            rows: 3

            card_id: app.selected_card_id
            card_image: None
            card_name: None

            ActionBar:
                size_hint: 1., 0.1
                ActionView:
                    use_separator: True
                    ActionPrevious:
                        title: 'Edit'
                        with_previous: False
                    ActionOverflow:
                    ActionButton:
                        text: 'Export'
                        on_release: card_edit.export_image()
                    ActionButton:
                        text: 'Import'
                        on_release: card_edit.import_image()

            Label:
                size_hint: 1., 0.1
                text: f"{card_edit.card_id}: {card_edit.card_name}"
            Image:
                size_hint: 1., 0.8
                source: ""
                allow_stretch: True
                texture: card_edit.card_image.texture if card_edit.card_image is not None else card_edit.card_image

    TabbedPanelItem:
        text: 'Settings'
        on_release: app.panel_settings()
        # Button:
        #     text: 'App Settings'
        #     on_release: app.open_settings()


<CardPanel>:
    cols: 1
    rows: 3
    id: card_panel
    image: image

    card_id: None
    card_image: None
    card_name: None

    on_release: app.select_for_edit(self.card_id)

    Label:
        size_hint_y: 0.1
        text: f"{card_panel.card_id}"
    Label:
        size_hint_y: 0.1
        text: f"{card_panel.card_name}" if card_panel.card_name is not None else "Loading"

    Image:
        id: image
        source: ""
        allow_stretch: True
        texture: card_panel.card_image.texture if card_panel.card_image is not None else card_panel.card_image



<LoadDialog>:
    future: None
    cols: 1
    rows: 3
    select_multiple: False
    filechooser: filechooser

    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            size_hint: (1., 0.95)
            multiselect: root.select_multiple

        GridLayout:
            cols: 2
            rows: 1
            size_hint: (1., 0.05)
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Load"
                disabled: not root.path_valid(filechooser.path, filechooser.selection)
                on_release: root.load(filechooser.path, filechooser.selection)

<SaveDialog>:
    text_input: text_input
    future: None
    cols: 1
    rows: 3
    filechooser: filechooser

    BoxLayout:
        size: root.size
        pos: root.pos
        orientation: "vertical"
        FileChooserListView:
            id: filechooser
            size_hint: (1., 0.9)
            on_selection: text_input.text = self.selection and self.selection[0] or ''

        TextInput:
            id: text_input
            size_hint: (1., 0.05)
            multiline: False

        GridLayout:
            size_hint: (1, 0.05)
            cols: 2
            rows: 1
            Button:
                text: "Cancel"
                on_release: root.cancel()

            Button:
                text: "Save"
                disabled: not root.path_valid(filechooser.path, text_input.text)
                on_release: root.save(filechooser.path, text_input.text)
